#### springboot

nginx做https请求转发到http,后端无法正确获取到https协议,Nginx+Tomcat正确获取客户端请求地址

	1. nginx配置

    ```nginx
    server {
      listen 8088 ssl;
      server_name cs.qyjbo.cn;
      client_max_body_size 100m;
      ssl_certificate /home/cert/cs.qyjbo.cn_sslkey/4120041_cs.qyjbo.cn.pem;
      ssl_certificate_key /home/cert/cs.qyjbo.cn_sslkey/4120041_cs.qyjbo.cn.key;
      ssl_session_timeout 5m;
      ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
      ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
      ssl_prefer_server_ciphers on;
      error_page 497 https://$host:8088$uri;
      location / {
        proxy_pass http://localhost:8090; 
        proxy_redirect http:// https://; 
        add_header Cache-Control    no-store;
        #获取正确的IP和端口号
        proxy_set_header Host $host:$server_port; 
        #获取正确请求的远程IP
        proxy_set_header X-Real-IP remote_addr;
        #获取正确的ip
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #获取正确的请求协议
        proxy_set_header X-Forwarded-Proto $scheme;
        #获取正确的访问端口号
        proxy_set_header X-Forwarded-Port $server_port;
     }
    }
    ```

	2. springboot配置

    ```yaml
    server
    	tomcat
    		remote_ip_header: x-forwarded-for
    		protocol_header: x-forwarded-proto
    		port-header: X-Forwarded-Port
    	use-forward-headers: true
    ```

    